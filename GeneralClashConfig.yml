#---------------------------------------------------#
# OpenClash 完全隐匿配置文件
# 所有流量走代理，无直连，完全防DNS泄露
# 适用于需要完全隐匿的场景
#---------------------------------------------------#

# ================ 基础设置 ================
mixed-port: 7890
allow-lan: true
bind-address: '*'
mode: rule
log-level: info
ipv6: false

# ================ API 接口 ================
external-controller: :9090
secret: ""

# ================ DNS配置（完全隐匿关键） ================
dns:
  enable: true                           # 启用DNS服务
  listen: 0.0.0.0:53                    # DNS监听地址
  ipv6: false                           # 禁用IPv6 DNS解析
  enhanced-mode: fake-ip                # 使用fake-ip模式
  fake-ip-range: 198.18.0.1/16         # fake-ip地址池
  fake-ip-filter:                       # 极简白名单，最大化隐匿
    - '*.lan'                            # 局域网域名（如 router.lan）
    - '*.local'                          # 本地域名（如 printer.local）
    
  # 不设置任何 nameserver - 强制所有DNS查询通过代理！
  # 这是完全隐匿的关键：连DNS查询都不走本地
  
  # 所有DNS查询都通过代理的国外DNS服务器
  fallback:
    - 'https://1.1.1.1/dns-query'        # Cloudflare DoH 通过代理
    - 'https://8.8.8.8/dns-query'        # Google DoH 通过代理
    - 'tls://1.1.1.1:853'               # Cloudflare DoT 通过代理
    - 'tls://8.8.4.4:853'               # Google DoT 通过代理
    - 'https://doh.opendns.com/dns-query' # OpenDNS DoH 通过代理
    - 'https://doh.familyshield.opendns.com/dns-query' # OpenDNS FamilyShield DoH 通过代理
    - '208.67.222.222:53'               # OpenDNS 主服务器 通过代理
    - '208.67.220.220:53'               # OpenDNS 备用服务器 通过代理
    - 'https://dns.quad9.net/dns-query'  # Quad9 DoH 通过代理
    
  # 关键：禁用所有过滤器，强制所有域名都使用fallback
  fallback-filter:
    geoip: false                        # 禁用GeoIP过滤
    # 不设置任何过滤条件，所有域名都走fallback（代理）

# ================ TUN设置 ================
tun:
  enable: true                          # 启用TUN模式
  stack: system                         # 使用系统网络栈
  auto-route: true                      # 自动路由
  auto-detect-interface: true           # 自动检测接口
  dns-hijack:                           # DNS劫持所有查询
    - any:53                            # 劫持所有DNS查询
    - tcp://any:53
    - udp://any:53

# ================ 实验性功能 ================
experimental:
  ignore-resolve-fail: true            # 忽略DNS解析失败

# ================ 代理设置 ================
proxies: []                             # 代理节点由订阅提供

# ================ 代理组设置 ================
proxy-groups: []                        # 代理组由订阅转换模板提供

# ================ 规则设置 ================
rules: []                               # 规则由订阅转换模板提供

# ================ 完全隐匿配置说明 ================
# 1. DNS完全隐匿：
#    - 不设置任何nameserver，避免本地DNS查询
#    - 所有DNS查询都通过fallback（代理）完成
#    - 禁用GeoIP过滤，确保没有域名走本地DNS
#
# 2. 流量完全代理：
#    - 配合订阅转换模板，所有规则都指向代理组
#    - 不使用绕过大陆功能
#    - FINAL规则也指向代理组
#
# 3. 防泄露机制：
#    - fake-ip模式避免真实DNS查询
#    - DNS劫持确保所有查询被Clash处理
#    - 最小化fake-ip-filter减少真实IP暴露
#
# 4. 性能考虑：
#    - 所有流量走代理会增加延迟
#    - DNS解析会比较慢（都通过代理）
#    - 建议选择延迟低的节点
