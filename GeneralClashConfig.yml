#---------------------------------------------------#
# OpenClash 全代理高匿名配置
# 完全隐匿 + DNS解析快速稳定 + 不被拦截
#---------------------------------------------------#

# ================ 基础设置 ================
mixed-port: 7890
allow-lan: true
bind-address: '*'
mode: rule
log-level: info
ipv6: false

# ================ API 接口 ================
external-controller: :9090
secret: ""

# ================ 配置文件设置 ================
profile:
  store-selected: true                  # 保存策略组选择
  store-fake-ip: true                   # 保存fake-ip映射（提升速度）

# ================ DNS配置（全代理+高速+防泄露） ================
dns:
  enable: true
  listen: 0.0.0.0:53
  ipv6: false
  enhanced-mode: fake-ip               # fake-ip模式（关键：完全隐匿）
  fake-ip-range: 198.18.0.1/16
  
  # 最小白名单 - 只保留路由器必需的
  fake-ip-filter:
    - '*.lan'
    - '*.local'
    
  # Bootstrap DNS（仅用于解析 DoH/DoT 服务器域名）
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
    
  # 主DNS服务器（全部通过代理 - 速度最快的组合）
  nameserver:
    - 'https://1.1.1.1/dns-query'      # Cloudflare DoH（最快）
    - 'https://1.0.0.1/dns-query'      # Cloudflare DoH备用
    - 'https://dns.google/dns-query'   # Google DoH
    - 'tls://1.1.1.1:853'             # Cloudflare DoT
    - 'tls://8.8.8.8:853'             # Google DoT
    
  # 备用DNS服务器（通过代理 - 容错机制）
  fallback:
    - 'https://doh.opendns.com/dns-query'     # OpenDNS DoH
    - 'https://cloudflare-dns.com/dns-query'  # Cloudflare 备用域名
    - 'https://dns.quad9.net/dns-query'       # Quad9 DoH
    - 'tls://dns.quad9.net:853'              # Quad9 DoT
    - '208.67.222.222:53'                     # OpenDNS UDP
    - '9.9.9.9:53'                            # Quad9 UDP
    
  # 备用DNS触发策略
  fallback-filter:
    geoip: true                        # 启用GeoIP判断
    geoip-code: CN                     # 中国IP走fallback（更安全）
    ipcidr:                            # 污染IP段走fallback
      - 240.0.0.0/4
      - 0.0.0.0/32
    domain:                            # 海外域名走fallback
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'
      - '+.twitter.com'
      - '+.githubusercontent.com'

# ================ TUN设置（严格模式 - 防DNS泄露） ================
tun:
  enable: true
  stack: system
  device: utun
  auto-route: true
  auto-detect-interface: true
  strict-route: true                   # 严格路由（防止流量绕过）
  endpoint-independent-nat: false      # 禁用端点无关NAT（防P2P泄露）
  dns-hijack:                          # DNS劫持（捕获所有DNS查询）
    - any:53
    - tcp://any:53

# ================ 实验性功能（提升兼容性） ================
experimental:
  ignore-resolve-fail: true            # 忽略DNS解析失败
  sniff-tls-sni: true                  # TLS SNI嗅探（提升准确性）
  sniff-http-host: true                # HTTP Host嗅探

# ================ 代理设置 ================
proxies: []                             # 由订阅提供

# ================ 代理组设置 ================
proxy-groups: []                        # 由订阅转换模板提供

# ================ 规则设置 ================
rules: []                               # 由订阅转换模板提供

#---------------------------------------------------#
# 配置说明
#---------------------------------------------------#
# 
# 【特性】
# ✓ 完全隐匿：所有DNS通过海外代理服务器
# ✓ 解析快速：Cloudflare 1.1.1.1 全球最快
# ✓ 不被拦截：DoH/DoT加密传输
# ✓ 智能容错：主DNS失败自动切换备用DNS
# ✓ 防泄露：fake-ip + 严格路由 + DNS劫持
#
# 【为什么快】
# - Cloudflare 1.1.1.1 延迟最低（通常<20ms）
# - DoH/DoT并发查询，自动选最快的
# - fake-ip缓存，二次访问秒开
# - 多个备用DNS分散风险
#
# 【配套订阅转换规则】
# ruleset=🏠 内网直连,[]IP-CIDR,127.0.0.0/8,no-resolve
# ruleset=🏠 内网直连,[]IP-CIDR,10.0.0.0/8,no-resolve
# ruleset=🏠 内网直连,[]IP-CIDR,172.16.0.0/12,no-resolve
# ruleset=🏠 内网直连,[]IP-CIDR,192.168.0.0/16,no-resolve
# ruleset=🏠 内网直连,[]IP-CIDR,169.254.0.0/16,no-resolve
# ruleset=🏠 内网直连,[]DOMAIN-SUFFIX,lan
# ruleset=🏠 内网直连,[]DOMAIN-SUFFIX,local
# ruleset=🇭🇰 家庭香港,[]IP-CIDR,5.5.5.5/32,no-resolve
# ruleset=🇭🇰 家庭香港,[]IP-CIDR,0.0.0.0/0,no-resolve
# ruleset=🇭🇰 家庭香港,[]MATCH
#---------------------------------------------------#
